---
title: "Diabetes Health Indicators Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: show
    theme: united
---

## install and load packages
```{r, echo=FALSE, warning=FALSE, message=FALSE}
install_and_load_packages <- function(packages) {
  output <- ""  # Initialize an empty string to collect messages
  
  for (pkg in packages) {
    if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
      output <- paste0(output, "Installing: ", pkg, "...\n")
      suppressMessages(suppressWarnings(
        install.packages(pkg, dependencies = TRUE, repos = "https://cran.rstudio.com/")
      ))
      output <- paste0(output, "✅ Successfully installed: ", pkg, "\n")
    }
    suppressMessages(suppressWarnings(
      library(pkg, character.only = TRUE))
    )
    output <- paste0(output, "✅ Loaded: ", pkg, "\n")
  }
  
  cat(output)  # Print all messages in one output cell
}

# List of packages needed for the analysis
packages <- c("dplyr", "ggplot2", "tidyr", "corrplot", "caret", "MASS", 
              "randomForest", "glmnet", "pROC", "e1071", "car", "rmarkdown", 
              "knitr", "kableExtra", "scales", "gridExtra", "reshape2")

# Install and load packages
install_and_load_packages(packages)

```

## Data Loading and Initial Exploration

```{r}
# Load the data
data = read.csv("./data/diabetes_012_health_indicators_BRFSS2015.csv", header=TRUE)
head(data)
str(data)

# Explore unique values for each variable in a more efficient way
unique_values <- lapply(data, unique)
unique_counts <- sapply(unique_values, length)

# Create a readable data frame with column names and unique value counts
unique_summary <- data.frame(
  Column = names(unique_counts),
  Unique_Values = unique_counts,
  row.names = NULL
)

# Display the summary table
print(unique_summary)

# To also see the actual unique values for each column (useful for categorical variables)
for (col in names(data)) {
  cat("\n", col, ":", "\n")
  print(sort(unique_values[[col]]))
  cat("--------------------------------\n")
}

# Define variables by measurement scale
variable_categories <- list(
  Nominal = c("Diabetes_012", "HighBP", "HighChol", "CholCheck", "Smoker", 
              "Stroke", "HeartDiseaseorAttack", "PhysActivity", "Fruits", 
              "Veggies", "HvyAlcoholConsump", "AnyHealthcare", "NoDocbcCost", 
              "DiffWalk", "Sex"),
  
  Ordinal = c("GenHlth", "Age", "Education", "Income"),
  
  Ratio = c("BMI", "MentHlth", "PhysHlth")
)

# Print summary of all variables by measurement scale
for (scale_name in names(variable_categories)) {
  cat("\n===", scale_name, "VARIABLES ===\n")
  var_list <- variable_categories[[scale_name]]
  
  # Create a data frame for this category's variables with variable names as row names
  summary_df <- data.frame(
    Unique_Values = sapply(var_list, function(v) length(unique(data[[v]]))),
    Class = sapply(var_list, function(v) class(data[[v]])[1]),
    row.names = var_list
  )
  
  print(summary_df)
}
```
## Project Objectives and Research Questions

### Project Objectives
1. Conduct comprehensive exploratory data analysis to identify statistically significant relationships between health indicators and diabetes status, including correlation analysis, distribution comparisons, and outlier detection.
2. Apply multivariate statistical methods to create prediction models for diabetes risk, evaluating the statistical significance and effect size of each predictor variable.
3. Perform comparative statistical analysis across demographic subgroups to identify significant differences in diabetes risk factors and prevalence.

### Research Questions
1. Which health indicators show statistically significant differences across the three diabetes status groups (no diabetes, prediabetes, diabetes), and what are their effect sizes?
2. Is there a statistically significant relationship between BMI and diabetes status when controlling for age, sex, and other confounding variables?
3. What is the statistical significance of lifestyle factors (physical activity, diet, smoking) in predicting diabetes status, and how do these factors interact with each other?
4. Using logistic regression modeling, which combination of variables provides the highest predictive power for diabetes classification, and what are their odds ratios?
5. Are there statistically significant differences in diabetes prevalence across socioeconomic categories (income, education), and how do these relationships change when controlling for health behaviors?


## Data Cleaning and Preprocessing
```{r message=FALSE, warning=FALSE}
# Check for duplicates
duplicate_count <- sum(duplicated(data))

# Calculate percentage of duplicates
duplicate_percentage <- (duplicate_count / nrow(data)) * 100

# Print number and percentage of duplicates found
cat("Number of duplicates found:", duplicate_count, "\n")
cat("Percentage of duplicates:", round(duplicate_percentage, 2), "%\n")

# Check for null/NA values in the dataset
na_counts <- colSums(is.na(data))
na_percentages <- round((na_counts / nrow(data)) * 100, 2)

# Create a summary data frame
null_summary <- data.frame(
  Column = names(data),
  NA_Count = na_counts,
  NA_Percentage = na_percentages
)

# Print only columns with null values (if any)
if(sum(na_counts) > 0) {
  cat("Columns with null values:\n")
  print(null_summary[null_summary$NA_Count > 0, ])
} else {
  cat("No null values found in the dataset.\n")
}

```